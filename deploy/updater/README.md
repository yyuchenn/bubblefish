# Tauri Auto-Updater Deployment

This directory contains the key generation script for the Tauri auto-updater functionality.

## Setup Instructions

### 1. Generate Signing Keys (One-time setup)

Run the following command to generate signing keys:

```bash
cd deploy/updater
./generate-keys.sh
```

This will generate:
- `updater.key` - Private key (keep secure, do not commit)
- `updater.key.pub` - Public key

### 2. Configure GitHub Secrets

Add the following secrets to your GitHub repository:

1. `TAURI_SIGNING_PRIVATE_KEY` - Contents of `updater.key`
2. `TAURI_SIGNING_PRIVATE_KEY_PASSWORD` - Password for the private key (if you set one)

### 3. Update Configuration

The public key has already been added to:
- `desktop/tauri.conf.json` - For lite version
- `desktop/tauri.bundled.conf.json` - For full version with plugins

### 4. GitHub Actions Workflow

The GitHub Actions workflow has been updated to:
- Sign releases automatically
- Generate and publish `latest.json` and `latest-bundled.json` to the `updater` branch

## How It Works

1. When a new release is created, GitHub Actions builds the applications
2. The built files are automatically signed using the private key from GitHub Secrets
3. Update manifests (`latest.json` and `latest-bundled.json`) are generated by the `update-manifests.yml` workflow
4. The manifests are pushed to the `updater` branch
5. The application checks these manifests for updates at runtime

## Update Endpoints

- Lite version: `https://raw.githubusercontent.com/yyuchenn/bubblefish/updater/latest.json`
- Full version: `https://raw.githubusercontent.com/yyuchenn/bubblefish/updater/latest-bundled.json`

## Signing Process

All signing is handled automatically by GitHub Actions during the release process. The workflow uses `cargo tauri signer sign` directly with the private key from GitHub Secrets.

## Testing Updates

1. Build and install an older version of the app
2. Create a new release with a higher version number
3. Wait for GitHub Actions to complete
4. Open the installed app and check for updates

## Troubleshooting

- Ensure the version in `tauri.conf.json` is updated before creating a release
- Check that the `updater` branch exists and is accessible
- Verify that the signing keys are correctly configured
- Check GitHub Actions logs for any errors during the build/sign process